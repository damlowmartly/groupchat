<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collaborative Calendar</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 20px; }
  .day { border: 1px solid #ccc; padding: 10px; height: 80px; position: relative; cursor: pointer; }
  .day .task-dot { width: 12px; height: 12px; border-radius: 50%; position: absolute; top: 5px; right: 5px; }
  #taskForm { margin-bottom: 20px; }
  #tasks { margin-top: 20px; }
  .task { border: 1px solid #ccc; padding: 5px; margin-bottom: 5px; border-left: 5px solid; }
</style>
</head>
<body>

<h1>Collaborative Calendar</h1>

<div id="calendar"></div>

<div id="taskForm">
  <input type="date" id="taskDate">
  <input type="time" id="taskTime">
  <input type="text" id="taskTitle" placeholder="Task Name">
  <input type="text" id="taskDesc" placeholder="Description">
  <button onclick="addTask()">Create +</button>
</div>

<div id="tasks"></div>

<script>
const colors = ['#FF6347','#1E90FF','#32CD32','#FFD700','#FF69B4','#8A2BE2','#00CED1'];
let tasks = [];

const calendarEl = document.getElementById('calendar');
const tasksEl = document.getElementById('tasks');

let selectedDate = null;

// Load tasks from server
async function loadTasks() {
  const res = await fetch('/tasks');
  tasks = await res.json();
  renderCalendar();
  if(selectedDate) renderTasks();
}

// Render calendar for current month
function renderCalendar() {
  calendarEl.innerHTML = '';
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1, 0).getDate();

  // Empty slots for first week
  for(let i=0; i<firstDay; i++){
    const empty = document.createElement('div');
    calendarEl.appendChild(empty);
  }

  for(let d=1; d<=daysInMonth; d++){
    const dateStr = `${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
    const dayEl = document.createElement('div');
    dayEl.className = 'day';
    dayEl.textContent = d;

    const dayTasks = tasks.filter(t => t.date === dateStr);
    if(dayTasks.length){
      const dot = document.createElement('div');
      dot.className = 'task-dot';
      dot.style.backgroundColor = dayTasks[0].color;
      dayEl.appendChild(dot);
    }

    dayEl.onclick = () => {
      selectedDate = dateStr;
      renderTasks();
    };

    calendarEl.appendChild(dayEl);
  }
}

// Render tasks for selected date
function renderTasks() {
  tasksEl.innerHTML = '';
  if(!selectedDate) return;
  const dayTasks = tasks.filter(t => t.date === selectedDate);
  dayTasks.forEach(t => {
    const div = document.createElement('div');
    div.className = 'task';
    div.style.borderLeftColor = t.color;
    div.innerHTML = `<strong>${t.time} - ${t.title}</strong><br>${t.desc}`;
    tasksEl.appendChild(div);
  });
}

// Add new task
async function addTask() {
  const date = document.getElementById('taskDate').value;
  const time = document.getElementById('taskTime').value;
  const title = document.getElementById('taskTitle').value;
  const desc = document.getElementById('taskDesc').value;

  if(!date || !time || !title) return alert('Fill date, time, and title');

  const color = colors[tasks.length % colors.length];

  await fetch('/tasks', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ date, time, title, desc, color })
  });

  document.getElementById('taskTitle').value = '';
  document.getElementById('taskDesc').value = '';
  await loadTasks();
}

// Initial load
loadTasks();
</script>

</body>
</html>
